var widthSmartphone=760;var widthTablet=1000;function alertNotify(b,a){alert(b+"\nYou are receiving this alert because: "+a)}function notify(a){if(a instanceof Error){vibrate()}if(!("Notification" in window)){alertNotify(a,"Notifications not supported")}else{if(Notification.permission==="granted"){new Notification(a)}else{if(Notification.permission!=="denied"){Notification.requestPermission(function(b){if(b==="granted"){new Notification(a);document.getElementById("notifications").innerHTML="Notifications supported and granted"}else{alertNotify(a,"No permission to send notifications")}})}}}}function hide(a){if(a.selector!=undefined){a.each(function(b){hide(a[b])})}else{if(!a.classList.contains("hidden")){a.classList.add("hidden")}}}function show(a){if(a.selector!=undefined){a.each(function(b){show(a[b])})}else{if(a.classList.contains("hidden")){a.classList.remove("hidden")}}}function showPage(g,e,f,d){if(d==null||d==undefined){d="page"}var a=document.getElementsByClassName(d);for(var c=0;c<a.length;c++){hide(a.item(c))}show($("#"+g));if(e){show($("#calendar"))}else{hide($("#calendar"))}if(f){show($(".courselink"))}else{hide($(".courselink"))}var b=document.getElementsByClassName("phonenav");for(c=0;c<b.length;c++){if(f){show(b.item(c))}else{hide(b.item(c))}}document.getElementById("show-menu").checked=false;adjustNav()}function adjustNav(){$(".bodyheight").each(function(a,b){var c=0;$("nav").each(function(d,e){c=e.clientHeight});b.setAttribute("style","min-height:calc(100vh - "+(201+c)+"px)")})}window.onresize=function(){if(window.innerWidth>widthSmartphone){if(!document.getElementById("calendarpage").classList.contains("hidden")){showPage("main",true)}}if(window.innerWidth<=widthTablet){if(!document.getElementById("files").classList.contains("hidden")){hide($("#grades"))}}else{show($("#files"));show($("#grades"))}adjustNav()};function initCourse(){if(window.innerWidth<=widthTablet){showPage("files",true,true,"secondarypage")}}function hideMenu(a){if(a){hide($("#show-menu"));hide($("#menu"));hide($("#menu-button"))}else{show($("#show-menu"));show($("#menu"));show($("#menu-button"))}}function showLogin(){showPage("login",false);hideMenu(true);$("#backlink").click(showLogin);hide($("#logout"))}function showMain(){showPage("main",true);hideMenu(false);$("#backlink").click(showMain);DaoGetCourses(coursesLoaded);showAllAssignments();show($("#logout"))}function showCourse(){showPage("coursepage",true,true);initCourse();hideMenu(false)}function showCalendar(){showPage("calendarpage",false);hideMenu(false);showAllAssignments()}function showFiles(){showPage("files",true,true,"secondarypage");hideMenu(false)}function showGrades(){showPage("grades",true,true,"secondarypage");hideMenu(false)}function loggedIn(a){if(a instanceof Error){notify(a)}else{notify("Login successfull");showMain()}}function showAllAssignments(){DaoGetAllAssignments(calendarLoaded);registerCalendarFunction(showAllAssignments)}function handleLogin(){var b=$("#username").val();var a=$("#password").val();if(b==null||b==undefined||a==null||a==undefined||a.length==0||b.length==0){notify("Please enter username and password")}else{login(b,a,loggedIn)}}function handleEvent(a){return function(){DaoGetGrade(a.courseid,a.name,function(b){notify(a.name+"\n"+a.desc+"\nAbzugeben am: "+a.duedate+"\n"+(b==null||(b.points=="-"&&b.percentage=="-")?"Keine Note bis jetzt":("Note"+b.points!=null?b.points:b.percentage)))})}}function setupVibration(){navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate}function vibrate(){if(navigator.vibrate){navigator.vibrate(1000)}}window.onload=function(){DaoInitStorage();if(isLoggedIn()){showMain()}else{showLogin()}$("#calendarlink").click(showCalendar);$("#logoutlink").click(handleLogout);$("#logoutmenulink").click(handleLogout);$("#gradelink").click(showGrades);$("#gradesec").click(showGrades);$("#filelink").click(showFiles);$("#filesec").click(showFiles);$("#btLogin").click(handleLogin);setupVibration();notify("Moodle is now ready")};function handleLogout(){logout();showLogin()}function registerCalendarFunction(a){$(".calendarframe").each(function(b,c){var d=c.contentDocument||iframe.contentWindow.document;if(d){c.contentWindow.setResetFunction(a)}})}function handleCourse(a){return function(){$("#courseHeading").html(a.name);DaoGetAssignments(a.id,function(b){calendarLoaded(b);var c=[];b.forEach(function(d){c.push(d.name)});DaoGetGrades(a.id,c,function(d){var e=[];d.forEach(function(f){if(f.found&&(f.points!="-"||f.percentage!="-")){f.grade=f.points=="-"?f.percentage:f.points;e.push(f)}});$("#gradetable").html(renderTemplate("grade-template",{grades:e}))})});DaoGetDetails(a.id,function(b){var c=[];b.forEach(function(d){d.modules.forEach(function(e){if(e.modname=="resource"){c.push(e)}})});$("#ulFiles").html(renderTemplate("file-template",{files:c}))});showCourse()}}function renderTemplate(d,a){var c=$("#"+d).html();var b=Handlebars.compile(c);return b(a)}function coursesLoaded(a){$("#courses").html(renderTemplate("course-template",{courses:a}));a.forEach(function(b){$("#course"+b.id).click(handleCourse(b))})}function calendarLoaded(a){var b=[];a.forEach(function(c){c.duedate=new Date(c.duedate);if(c.duedate>=new Date()){b.push(c)}});b.sort(function(d,c){if(d.duedate==null&&c.duedate==null){return 0}if(d.duedate==null){return 1}if(c.duedate==null){return -1}return d.duedate.getTime()-c.duedate.getTime()});$(".assignments").each(function(c,d){d.innerHTML=renderTemplate("assignment-template",{assignments:b})});$(".calendarframe").each(function(d,f){var g=f.contentDocument||iframe.contentWindow.document;if(g){var h=g.getElementsByClassName("calendarday");for(var e=0;e<h.length;e++){var c=h.item(e);c.onclick=null;if(c.classList.contains("event")){c.classList.remove("event")}}a.forEach(function(k){var j=new Date(k.duedate);var i=g.getElementById(j.getFullYear()+"_"+(j.getMonth())+"_"+j.getDate());if(i!=null&&i!=undefined){i.classList.add("event");i.onclick=handleEvent(k)}})}})};